// HIGHER ORDER FUNCTIONS
// A function which takes other function as arguments or return functions

// TOPICS
    // 1. map, filter, reduce
    // 2. currying
    // 3. composition

//===============================================================================================================================
// PROBLEM 1
// Sum of squares of even numbers in an array.
function sumOfEvenSquare(arr) {

    let result = arr.filter(num => num % 2 === 0).map(num => num * num).reduce((acc, num) => acc + num, 0);
    
    return result;
}

console.log(sumOfEvenSquare([2,4,3,5,7, 10,22]));

// USING RECUSRION
function sumOfEvenSquareRecursive(arr, index = 0) {

    if(index >= arr.length) return 0;

    let num = arr[index];

    if(num % 2 === 0) {
        
        return num * num + sumOfEvenSquareRecursive(arr, index + 1);
    
    } else {

        return sumOfEvenSquareRecursive(arr, index + 1);
    }
}

console.log(sumOfEvenSquare([2,4,3,5,7, 10,22]));
//===============================================================================================================================
// PROBLEM 2
// Implement your own map.
// Map - takes array as an input - transforms the element based on logic - returns new array
function double(value) {
    return value * 2
}

function customMap(arr, cb) {

    let result = [];

    for(let i = 0; i < arr.length; i++) {
        
        result.push(cb(arr[i], i, arr))
    }

    return result;
}

console.log(customMap([1,2,3], double));

Array.prototype.myMap = function(cb) {

    let result = [];
    
    for(let i = 0; i < this.length; i++) {
    
        result.push(cb(this[i], i, this))
    }
    
    return result;
}

console.log([10,20,30].myMap((num) => num * 2));
//===============================================================================================================================
// PROBLEM 3
// Implement your own filter.
// Filter - takes array as input - filter the based on condition function - returns new array
function lessThan10(value) {
    
    return value < 10;
}

function customFilter(arr, cb) {

    let result = [];

    for(let i = 0; i < arr.length; i++) {

        if(cb(arr[i], i, arr)) {

            result.push(arr[i])
        }
    }

    return result;
}

console.log(customFilter([7,1,3,11,14,5], lessThan10));

Array.prototype.myFilter = function(cb) {
    let result = [];
    for(let i = 0; i < this.length; i++) {
        if(cb(this[i], i, this)) {
            result.push(this[i])
        }
    }
    return result;
}

console.log([7,1,3,11,14,5].myFilter(lessThan10));
//===============================================================================================================================
// PROBLEM 4
// Implement your own reduce.
// Reduce - iterates over array - applies callback function on each element - and accumulates a single value
// Optionally we can provide initial value else it will take first value of array 

function sum(acc, curr) {

    return acc + curr
}

function customReduce(arr, cb, initValue) {

    let result;
    let i = 0;

    if(initValue !== undefined) {
       
        result = initValue;
    
    } else {
    
        if(arr.length === 0) throw new Error('Empty Array');
    
        result = arr[0];
    
        i = 1
    }

    for(let i = 0; i < arr.length; i++) {

        result = cb(result, arr[i])
    }

    return result;
}

console.log(customReduce([1,2,3,5], sum));

Array.prototype.myReduce = function(cb, initValue) {

    let result;
    let i = 0;

    if(initValue !== undefined) {
       
        result = initValue;
    
    } else {
    
        if(this.length === 0) throw new Error('Empty Array');
    
        result = this[0];
    
        i = 1
    }

    for(; i < this.length; i++) {

        result = cb(result, this[i])
    }

    return result;
}

console.log([3,2,4].myReduce((acc, curr) => acc * curr));
//===============================================================================================================================
// PROBLEM 5
// Compose two functions: double and increment.
// Function Composition
// Chaining multiple functions to form a new function
// Output of one function becomes input of the next function in the chain

// WITH REDUCERIGHT AND SINGLE ARGUMENTS
function compose(...functions) {

    return function(value) {

        return functions.reduceRight((acc, curr) => {

            return curr(acc)
        }, value)
    }
}

// FOR MORE GENERIC MULTIPLE ARGUMENTS
function genericCompose(...funcs) {
    
    return function(...args) {

        let result = funcs[funcs.length - 1](...args);
        
        for(let i = funcs.length - 2 ; i >= 0; i--) {

            result = funcs[i](result)
        }

        return result
    }
}

function double(x) {
    return x * 2;
}

function increment(x) {
    return x + 1
}

let doubleAndIncrement = genericCompose(double, increment);
console.log(doubleAndIncrement(10));

function pipe(...functions) {

    return function(...args) {

        let result = functions[0](...args);
        
        for(let i = 1; i < functions.length; i++) {

            result = functions[i](result)
        }

        return result
    }
}

function add(x, y) {
    return x + y;
}

function increment(x) {
    return x + 1
}

let doubleAndIncrement1 = pipe(add, increment);
console.log(doubleAndIncrement1(10, 20));

//===============================================================================================================================
// PROBLEM 6
// Use map to double all numbers in an array.
const doubleArr = (arr) => arr.map(num => num * 2)
console.log(doubleArr([1,2,3,4,5]), 'map');
//===============================================================================================================================
// PROBLEM 7
// Use filter to get all even numbers.
const filterEvenNums = (arr) => arr.filter(num => num % 2 === 0);
console.log(filterEvenNums([1,2,3,4,5]), 'filter');
//===============================================================================================================================
// PROBLEM 8
// Use reduce to calculate the sum of numbers.
const reduceSum = (arr) => arr.reduce((acc, cur) => acc + cur);
console.log(reduceSum([1,2,3,4,5]), 'reduce');
//===============================================================================================================================
// PROBLEM 9
// Implement a function that takes an array and a callback, and returns the first element passing the callback.
function returnTest(arr, cb) {
    for(let i = 0; i < arr.length; i++) {
        if(cb(arr[i])) {
            return arr[i]
        }
    }
}
function cb1(num) {
    return num
}
console.log(returnTest([1,2,3], cb1));
//===============================================================================================================================
// PROBLEM 10
// Count occurrences of each element in an array using reduce.
function occurrences(arr) {
    return arr.reduce((acc, cur) => {
        cur = String(cur).toLowerCase()
        acc[cur] = (acc[cur] || 0) + 1  
        return acc;
    }, {})
}
console.log(occurrences([1,2,3,4,3,2]));
console.log(occurrences(['Apple', 'Orange', 'Banana', 'apple']));
//===============================================================================================================================
// PROBLEM 11
// Flatten an array of arrays using reduce.
function flatArrs(arr) {

    return arr.reduce((acc, cur) => {

        if(Array.isArray(cur)) {
           
            return acc.concat(flatArrs(cur))
        
        } else {
           
            return acc.concat(cur);
        }

    }, []);
}

console.log(flatArrs([1,2,3,[4,5, [6,7]]]));
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================
//===============================================================================================================================